<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ××ª×›×•× ×™×</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .recipe-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .recipe-info h2 {
            color: #555;
            font-size: 1.5em;
        }

        .quantity-badge {
            background: #667eea;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .recipe-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .recipe-selection-header h2 {
            margin: 0;
            font-size: 1.5em;
        }
        
        .recipe-selection-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recipe-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .quantity-selection-section h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .quantity-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quantity-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .quantity-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .kit-instructions {
            margin: 30px 0;
        }

        .kit-meta {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #444;
        }

        .kit-meta span {
            background: #eef2ff;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .kit-instructions h3 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .ingredients-list {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .ingredient-item {
            background: white;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 1.2em;
        }

        .ingredient-name {
            font-weight: bold;
            color: #333;
        }

        .ingredient-amount {
            color: #667eea;
            font-weight: bold;
        }

        .oven-instructions {
            margin: 30px 0;
        }

        .oven-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .setting-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .setting-label {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .setting-value {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary {
            background: #999;
            color: white;
        }

        .btn-secondary:hover {
            background: #777;
            transform: translateY(-2px);
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #5568d3;
        }

        .admin-panel {
            margin-top: 30px;
        }

        .recipe-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .ingredient-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .ingredient-row input,
        .ingredient-row select {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
        }

        .remove-ingredient {
            background: #ff4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            line-height: 1;
        }

        .btn-add {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .admin-recipes-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .admin-recipe-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .admin-recipe-item h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .admin-recipe-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-edit,
        .btn-delete {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-delete {
            background: #ff4444;
            color: white;
        }

        .screen {
            display: block;
            animation: fadeIn 0.2s ease-in;
        }

        .screen.hidden {
            display: none;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .action-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .action-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .action-desc {
            font-size: 1em;
            opacity: 0.9;
        }

        .container-type-selection h2,
        .oven-type-selection h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .container-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .container-btn {
            background: white;
            border: 3px solid #ddd;
            padding: 20px 40px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-width: 150px;
        }

        .container-btn:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .container-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .container-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .container-title {
            font-size: 1.3em;
            font-weight: bold;
        }

        .division-content {
            margin-top: 20px;
        }

        .division-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            font-size: 1.2em;
        }

        .info-label {
            font-weight: bold;
            color: #333;
        }

        .info-value {
            color: #667eea;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }

        /* ×¨×¡×¤×•× ×¡×™×‘×™×•×ª ×œ××•×‘×™×™×œ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
                border-radius: 15px;
            }
            
            header {
                margin-bottom: 20px;
                padding-bottom: 15px;
            }
            
            header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
            }
            
            .recipe-info h2 {
                font-size: 1.2em;
            }
            
            /* ×›×¤×ª×•×¨×™× ×‘××¡×š ×¨××©×™ */
            .recipe-selection-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .recipe-selection-header h2 {
                font-size: 1.3em;
                text-align: center;
            }
            
            .recipe-selection-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .recipe-selection-buttons .btn,
            .recipe-selection-buttons .refresh-btn {
                width: 100%;
                padding: 12px;
                font-size: 1em;
            }
            
            /* ×¨×©×ª ××ª×›×•× ×™× */
            .recipes-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .recipe-card {
                padding: 20px;
                font-size: 1.1em;
            }
            
            /* ×›×¤×ª×•×¨×™ ×›××•×ª */
            .quantity-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .quantity-btn {
                padding: 15px 10px;
                font-size: 1.1em;
            }
            
            /* ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” */
            .action-buttons {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .action-btn {
                padding: 25px 20px;
            }
            
            .action-icon {
                font-size: 2.5em;
            }
            
            .action-title {
                font-size: 1.3em;
            }
            
            /* ×›×¤×ª×•×¨×™ ×ª×‘× ×™×ª */
            .container-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .container-btn {
                width: 100%;
                padding: 15px 20px;
                min-width: auto;
            }
            
            /* ×˜×•×¤×¡ */
            .form-section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .form-section h2 {
                font-size: 1.2em;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .form-group label {
                font-size: 1em;
            }
            
            .form-group input,
            .form-group textarea,
            .form-group select {
                padding: 10px;
                font-size: 0.95em;
            }
            
            /* ×©×•×¨×•×ª ×¨×›×™×‘×™× */
            .ingredient-row {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }
            
            .ingredient-row input,
            .ingredient-row select {
                width: 100%;
            }
            
            .remove-ingredient {
                width: 100%;
                height: 40px;
                border-radius: 8px;
            }
            
            /* ×›×¤×ª×•×¨×™ ×˜×•×¤×¡ */
            .form-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .form-actions .btn {
                width: 100%;
                padding: 12px;
                font-size: 1em;
            }
            
            /* ××™×“×¢ */
            .division-info,
            .oven-info {
                padding: 15px;
            }
            
            .info-item,
            .setting-item {
                padding: 15px;
                font-size: 1em;
                flex-direction: column;
                gap: 8px;
            }
            
            .info-label,
            .setting-label {
                font-size: 0.95em;
            }
            
            .info-value,
            .setting-value {
                font-size: 1.1em;
            }
            
            /* ×¨×©×™××ª ×¨×›×™×‘×™× */
            .ingredients-list {
                padding: 15px;
            }
            
            .ingredient-item {
                padding: 12px 15px;
                font-size: 1em;
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            /* ×›×¤×ª×•×¨×™ × ×™×”×•×œ */
            .admin-recipe-actions {
                flex-direction: column;
            }
            
            .admin-recipe-actions .btn-edit,
            .admin-recipe-actions .btn-delete {
                width: 100%;
            }
            
            /* ×›×¤×ª×•×¨×™ ×—×–×¨×” */
            .btn-secondary {
                width: 100%;
                margin-bottom: 10px;
            }
            
            /* ××˜× ×§×™×˜ */
            .kit-meta {
                flex-direction: column;
                gap: 10px;
            }
            
            .kit-meta span {
                text-align: center;
            }
        }
        
        /* ×˜×‘×œ×˜×™× */
        @media (max-width: 1024px) and (min-width: 769px) {
            .container {
                padding: 20px;
            }
            
            .recipes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* ××¡×›×™× ×§×˜× ×™× ×××•×“ */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
                border-radius: 10px;
            }
            
            header h1 {
                font-size: 1.5em;
            }
            
            .quantity-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .quantity-btn {
                padding: 12px 8px;
                font-size: 1em;
            }
            
            .recipe-card {
                padding: 15px;
                font-size: 1em;
            }
            
            .action-btn {
                padding: 20px 15px;
            }
            
            .action-icon {
                font-size: 2em;
            }
            
            .action-title {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ××¡×š ×¨××©×™ - ×‘×—×™×¨×ª ××ª×›×•×Ÿ -->
        <div id="main-screen" class="screen active">
            <header>
                <h1>××¢×¨×›×ª ××ª×›×•× ×™×</h1>
            </header>
            
            <div class="recipe-selection">
                <div class="recipe-selection-header">
                    <h2>×‘×—×¨ ××ª×›×•×Ÿ</h2>
                    <div class="recipe-selection-buttons">
                        <button id="add-recipe-btn" class="btn btn-primary">â• ×”×•×¡×£ ××ª×›×•×Ÿ</button>
                        <button id="edit-recipes-btn" class="btn btn-secondary">âœï¸ ×¢×¨×•×š ××ª×›×•× ×™×</button>
                        <button id="refresh-btn" class="refresh-btn" title="×¨×¢× ×•×Ÿ ×¨×©×™××ª ××ª×›×•× ×™×">ğŸ”„ ×¨×¢× ×•×Ÿ</button>
                    </div>
                </div>
                <div id="recipes-list" class="recipes-grid">
                    <div class="loading">×˜×•×¢×Ÿ ××ª×›×•× ×™×...</div>
                </div>
            </div>
        </div>

        <!-- ××¡×š ×‘×—×™×¨×ª ×¤×¢×•×œ×” ×œ××—×¨ ×‘×—×™×¨×ª ××ª×›×•×Ÿ -->
        <div id="action-selection-screen" class="screen hidden">
            <header>
                <h1 id="selected-recipe-name"></h1>
                <button id="back-to-main" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="action-buttons">
                <button id="kit-action-btn" class="action-btn">
                    <div class="action-icon">ğŸ“¦</div>
                    <div class="action-title">×§×™×˜×™×</div>
                    <div class="action-desc">×—×•××¨×™ ×’×œ× ×•×”×›× ×ª ×”×§×™×˜</div>
                </button>
                <button id="division-action-btn" class="action-btn">
                    <div class="action-icon">ğŸ¥˜</div>
                    <div class="action-title">×—×œ×•×§×” ×œ×ª×‘× ×™×•×ª</div>
                    <div class="action-desc">×’×¡×˜×¨×•× ×•× / ×¡×™×¤×˜</div>
                </button>
                <button id="oven-action-btn" class="action-btn">
                    <div class="action-icon">ğŸ”¥</div>
                    <div class="action-title">×ª× ×•×¨</div>
                    <div class="action-desc">×”×•×¨××•×ª ××¤×™×™×”</div>
                </button>
            </div>
        </div>

        <!-- ××¡×š ×§×™×˜×™× -->
        <div id="kit-screen" class="screen hidden">
            <header>
                <h1>×§×™×˜×™× - ×—×•××¨×™ ×’×œ×</h1>
                <div class="recipe-info">
                    <h2 id="kit-recipe-name"></h2>
                </div>
                <button id="back-from-kit" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="quantity-selection-section">
                <h2>×‘×—×¨ ×›××•×ª (×‘×›×¤×•×œ×•×ª ×©×œ 10 ×§"×’)</h2>
                <div class="quantity-buttons">
                    <button class="quantity-btn" data-quantity="10">10 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="20">20 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="30">30 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="40">40 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="50">50 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="60">60 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="70">70 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="80">80 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="90">90 ×§"×’</button>
                    <button class="quantity-btn" data-quantity="100">100 ×§"×’</button>
                </div>
            </div>
            
            <div id="kit-content" class="kit-instructions">
                <div class="kit-meta">
                    <span id="base-batch-info">×›××•×ª ×‘×¡×™×¡: 10 ×§"×’</span>
                    <span id="multiplier-info">××›×¤×™×œ: x1</span>
                    <span id="selected-quantity-badge" class="quantity-badge" style="display: none;"></span>
                </div>
                <h3>×¨×›×™×‘×™× ×œ×§×™×˜:</h3>
                <div id="kit-ingredients" class="ingredients-list">
                    <!-- ×™×•×˜×¢×Ÿ ×“×™× ××™×ª -->
                </div>
            </div>
        </div>

        <!-- ××¡×š ×—×œ×•×§×” ×œ×ª×‘× ×™×•×ª -->
        <div id="division-screen" class="screen hidden">
            <header>
                <h1>×—×œ×•×§×” ×œ×ª×‘× ×™×•×ª</h1>
                <div class="recipe-info">
                    <h2 id="division-recipe-name"></h2>
                </div>
                <button id="back-from-division" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="container-type-selection">
                <h2>×‘×—×¨ ×¡×•×’ ×ª×‘× ×™×ª:</h2>
                <div class="container-buttons">
                    <button id="gastronorm-btn" class="container-btn active" data-type="gastronorm">
                        <div class="container-icon">ğŸ¥˜</div>
                        <div class="container-title">×’×¡×˜×¨×•× ×•×</div>
                    </button>
                    <button id="sift-btn" class="container-btn" data-type="sift">
                        <div class="container-icon">ğŸ</div>
                        <div class="container-title">×¡×™×¤×˜</div>
                    </button>
                </div>
            </div>
            
            <div id="division-content" class="division-content">
                <!-- ×™×•×˜×¢×Ÿ ×“×™× ××™×ª ×œ×¤×™ ×‘×—×™×¨×” -->
            </div>
        </div>

        <!-- ××¡×š ×ª× ×•×¨ -->
        <div id="oven-screen" class="screen hidden">
            <header>
                <h1>×”×•×¨××•×ª ×ª× ×•×¨</h1>
                <div class="recipe-info">
                    <h2 id="oven-recipe-name"></h2>
                </div>
                <button id="back-from-oven" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="oven-type-selection">
                <h2>×‘×—×¨ ×¡×•×’ ×ª×‘× ×™×ª:</h2>
                <div class="container-buttons">
                    <button id="oven-gastronorm-btn" class="container-btn active" data-type="gastronorm">
                        <div class="container-icon">ğŸ¥˜</div>
                        <div class="container-title">×’×¡×˜×¨×•× ×•×</div>
                    </button>
                    <button id="oven-sift-btn" class="container-btn" data-type="sift">
                        <div class="container-icon">ğŸ</div>
                        <div class="container-title">×¡×™×¤×˜</div>
                    </button>
                </div>
            </div>
            
            <div id="oven-content" class="oven-instructions">
                <!-- ×™×•×˜×¢×Ÿ ×“×™× ××™×ª ×œ×¤×™ ×‘×—×™×¨×” -->
            </div>
        </div>

        <!-- ××¡×š ×”×•×¡×¤×ª/×¢×¨×™×›×ª ××ª×›×•×Ÿ -->
        <div id="admin-screen" class="screen hidden">
            <header>
                <h1 id="admin-title">×”×•×¡×£ ××ª×›×•×Ÿ ×—×“×©</h1>
                <button id="back-from-admin" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="admin-panel">
                <form id="add-recipe-form" class="recipe-form">
                    <!-- ×—×œ×§ 1: ×¨×›×™×‘×™× ×•×”×•×¨××•×ª ×”×›× ×” -->
                    <div class="form-section">
                        <h2>1. ×¨×›×™×‘×™× ×•×”×•×¨××•×ª ×”×›× ×”</h2>
                        <div class="form-group">
                            <label>×©× ×”××ª×›×•×Ÿ:</label>
                            <input type="text" id="recipe-name-input" required>
                        </div>
                        <div class="form-group">
                            <label>×›××•×ª ×‘×¡×™×¡ (×§"×’):</label>
                            <input type="number" id="base-batch-input" step="0.1" min="1" value="10" required>
                            <small>×”×›××•×™×•×ª ×‘×˜×‘×œ×” ××—×•×©×‘×•×ª ×œ×¤×™ ×›××•×ª ×–×• (×œ××©×œ 10 ×§"×’).</small>
                        </div>
                        <div class="form-group">
                            <label>×¨×›×™×‘×™ ×§×™×˜:</label>
                            <div id="kit-ingredients-inputs">
                                <div class="ingredient-row">
                                    <input type="text" placeholder="×©× ×¨×›×™×‘" class="ingredient-name">
                                    <input type="number" placeholder="×›××•×ª" class="ingredient-amount" step="0.01" min="0">
                                    <select class="ingredient-unit">
                                        <option value="×’×¨×">×’×¨×</option>
                                        <option value="×§"×’">×§"×’</option>
                                        <option value="×"×œ">×"×œ</option>
                                        <option value="×œ×™×˜×¨">×œ×™×˜×¨</option>
                                        <option value="×›×¤×™×•×ª">×›×¤×™×•×ª</option>
                                        <option value="×›×¤×•×ª">×›×¤×•×ª</option>
                                        <option value="×›×•×¡×•×ª">×›×•×¡×•×ª</option>
                                        <option value="×™×—×™×“×•×ª">×™×—×™×“×•×ª</option>
                                        <option value="×—×‘×™×œ×•×ª">×—×‘×™×œ×•×ª</option>
                                    </select>
                                    <button type="button" class="remove-ingredient">Ã—</button>
                                </div>
                            </div>
                            <button type="button" id="add-kit-ingredient" class="btn-add">+ ×”×•×¡×£ ×¨×›×™×‘ ×§×™×˜</button>
                        </div>
                        <div class="form-group">
                            <label>×”×•×¨××•×ª ×”×›× ×”:</label>
                            <textarea id="preparation-instructions" rows="4" placeholder="×”×•×¨××•×ª ×”×›× ×ª ×”×§×™×˜..."></textarea>
                        </div>
                    </div>

                    <!-- ×—×œ×§ 2: ××™× ×•×—×•×’ - ×’×¡×˜×¨×•× ×•× -->
                    <div class="form-section">
                        <h2>2. ××™× ×•×—×•×’ - ×’×¡×˜×¨×•× ×•×</h2>
                        <div class="form-group">
                            <label>×›××•×ª ×—×•×’ (×§"×’):</label>
                            <input type="number" id="gastronorm-dough-amount" step="0.1" min="0" placeholder="×›××•×ª ×—×•×’ ×œ×’×¡×˜×¨×•× ×•×">
                        </div>
                        <div class="form-group">
                            <label>×›××•×ª ××™× (×œ×™×˜×¨):</label>
                            <input type="number" id="gastronorm-water-amount" step="0.1" min="0" placeholder="×›××•×ª ××™× ×œ×’×¡×˜×¨×•× ×•×">
                        </div>
                        <div class="form-group">
                            <label>×¡×•×’ ××™×:</label>
                            <select id="gastronorm-water-type">
                                <option value="×—×">×—×</option>
                                <option value="×§×¨">×§×¨</option>
                            </select>
                        </div>
                    </div>

                    <!-- ×—×œ×§ 3: ××™× ×•×—×•×’ - ×¡×™×¤×˜ -->
                    <div class="form-section">
                        <h2>3. ××™× ×•×—×•×’ - ×¡×™×¤×˜</h2>
                        <div class="form-group">
                            <label>×›××•×ª ×—×•×’ (×§"×’):</label>
                            <input type="number" id="sift-dough-amount" step="0.1" min="0" placeholder="×›××•×ª ×—×•×’ ×œ×¡×™×¤×˜">
                        </div>
                        <div class="form-group">
                            <label>×›××•×ª ××™× (×œ×™×˜×¨):</label>
                            <input type="number" id="sift-water-amount" step="0.1" min="0" placeholder="×›××•×ª ××™× ×œ×¡×™×¤×˜">
                        </div>
                        <div class="form-group">
                            <label>×¡×•×’ ××™×:</label>
                            <select id="sift-water-type">
                                <option value="×—×">×—×</option>
                                <option value="×§×¨">×§×¨</option>
                            </select>
                        </div>
                    </div>

                    <!-- ×—×œ×§ 4: ×ª× ×•×¨ - ×’×¡×˜×¨×•× ×•× -->
                    <div class="form-section">
                        <h2>4. ×ª× ×•×¨ - ×’×¡×˜×¨×•× ×•×</h2>
                        <div class="form-group">
                            <label>×¡×•×’ ×ª×•×›× ×™×ª:</label>
                            <input type="text" id="gastronorm-oven-program" placeholder="×œ××©×œ: ××©×•×œ×‘, ×—×•× ×™×‘×©, ×•×›×•'">
                        </div>
                        <div class="form-group">
                            <label>×˜××¤×¨×˜×•×¨×” (Â°C):</label>
                            <input type="number" id="gastronorm-oven-temp" step="1" min="0" placeholder="×˜××¤×¨×˜×•×¨×ª ××¤×™×™×”">
                        </div>
                        <div class="form-group">
                            <label>×–××Ÿ (×“×§×•×ª):</label>
                            <input type="number" id="gastronorm-oven-time" step="1" min="0" placeholder="×–××Ÿ ××¤×™×™×”">
                        </div>
                        <div class="form-group">
                            <label>×œ×—×•×ª (%):</label>
                            <input type="number" id="gastronorm-oven-humidity" step="1" min="0" max="100" placeholder="×œ×—×•×ª">
                        </div>
                        <div class="form-group">
                            <label>×”×¢×¨×•×ª:</label>
                            <textarea id="gastronorm-oven-notes" rows="3" placeholder="×”×•×¨××•×ª × ×•×¡×¤×•×ª..."></textarea>
                        </div>
                    </div>

                    <!-- ×—×œ×§ 5: ×ª× ×•×¨ - ×¡×™×¤×˜ -->
                    <div class="form-section">
                        <h2>5. ×ª× ×•×¨ - ×¡×™×¤×˜</h2>
                        <div class="form-group">
                            <label>×¡×•×’ ×ª×•×›× ×™×ª:</label>
                            <input type="text" id="sift-oven-program" placeholder="×œ××©×œ: ××©×•×œ×‘, ×—×•× ×™×‘×©, ×•×›×•'">
                        </div>
                        <div class="form-group">
                            <label>×˜××¤×¨×˜×•×¨×” (Â°C):</label>
                            <input type="number" id="sift-oven-temp" step="1" min="0" placeholder="×˜××¤×¨×˜×•×¨×ª ××¤×™×™×”">
                        </div>
                        <div class="form-group">
                            <label>×–××Ÿ (×“×§×•×ª):</label>
                            <input type="number" id="sift-oven-time" step="1" min="0" placeholder="×–××Ÿ ××¤×™×™×”">
                        </div>
                        <div class="form-group">
                            <label>×œ×—×•×ª (%):</label>
                            <input type="number" id="sift-oven-humidity" step="1" min="0" max="100" placeholder="×œ×—×•×ª">
                        </div>
                        <div class="form-group">
                            <label>×”×¢×¨×•×ª:</label>
                            <textarea id="sift-oven-notes" rows="3" placeholder="×”×•×¨××•×ª × ×•×¡×¤×•×ª..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">×©××•×¨ ××ª×›×•×Ÿ</button>
                        <button type="button" id="cancel-edit-btn" class="btn btn-secondary hidden">×‘×™×˜×•×œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ××¡×š ×¢×¨×™×›×ª ××ª×›×•× ×™× -->
        <div id="edit-list-screen" class="screen hidden">
            <header>
                <h1>×¢×¨×™×›×ª ××ª×›×•× ×™×</h1>
                <button id="back-from-edit-list" class="btn btn-secondary">â† ×—×–×•×¨</button>
            </header>
            
            <div class="recipes-list-section">
                <div id="admin-recipes-list" class="admin-recipes-list">
                    <div class="loading">×˜×•×¢×Ÿ ××ª×›×•× ×™×...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ×”×’×“×¨×ª Google Apps Script
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxvj4K2biGQe899qT-cj238mfMYIY_uzdhqZ92oQyGEUw2CKnqApPA9_KkHXGwzJZHg/exec';

        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª ××ª×›×•× ×™×
        async function loadRecipes() {
            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=get`);
                const data = await response.json();
                return data.recipes || [];
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××ª×›×•× ×™×:', error);
                return [];
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×©××™×¨×ª ××ª×›×•× ×™×
        async function saveRecipes(recipes) {
            try {
                console.log('×©×•×œ×— ××ª×›×•× ×™× ×œ×©××™×¨×”:', recipes);
                console.log('××¡×¤×¨ ××ª×›×•× ×™×:', recipes.length);
                console.log('URL:', APPS_SCRIPT_URL);
                
                const payload = {
                    action: 'save',
                    recipes: recipes
                };
                
                console.log('Payload:', JSON.stringify(payload, null, 2));
                console.log('×’×•×“×œ ×”-payload:', JSON.stringify(payload).length, '×ª×•×•×™×');
                
                // × × ×¡×” ×§×•×“× ×¢× cors ×¨×’×™×œ ×›×“×™ ×œ×¨××•×ª ××ª ×”×ª×©×•×‘×”
                try {
                    console.log('×× ×¡×” ×œ×©×œ×•×— ×¢× CORS...');
                    const response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        headers: { 
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    console.log('×ª×’×•×‘×” ×”×ª×§×‘×œ×”:', response.status, response.statusText);
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('×ª×•×¦××” ×-Apps Script:', result);
                        if (result.success) {
                            console.log('âœ… ×©××™×¨×” ×”×¦×œ×™×—×”!');
                            return true;
                        } else {
                            console.error('âŒ ×©××™×¨×” × ×›×©×œ×”:', result.error);
                            throw new Error(result.error || '×©××™×¨×” × ×›×©×œ×”');
                        }
                    } else {
                        console.error('âŒ ×©×’×™××ª HTTP:', response.status);
                        const text = await response.text();
                        console.error('×ª×•×›×Ÿ ×”×ª×’×•×‘×”:', text);
                        throw new Error(`×©×’×™××ª HTTP: ${response.status}`);
                    }
                } catch (corsError) {
                    console.warn('CORS × ×›×©×œ, ×× ×¡×” ×¢× no-cors:', corsError);
                    
                    // ×× CORS × ×›×©×œ, × × ×¡×” ×¢× no-cors (××‘×œ ×œ× × ×•×›×œ ×œ×¨××•×ª ××ª ×”×ª×©×•×‘×”)
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                    
                    // × ×—×›×” ×§×¦×ª ×›×“×™ ×œ×•×•×“× ×©×”×©××™×¨×” ×”×¡×ª×™×™××”
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    console.log('âš ï¸ × ×©×œ×— ×¢× no-cors - ×œ× × ×™×ª×Ÿ ×œ×•×•×“× ×©×”×©××™×¨×” ×”×¦×œ×™×—×”');
                    console.log('×‘×“×•×§ ××ª ×”×œ×•×’×™× ×‘-Apps Script ×›×“×™ ×œ×•×•×“× ×©×”× ×ª×•× ×™× ×”×ª×§×‘×œ×•');
                    return true;
                }
                
            } catch (error) {
                console.error('âŒ ×©×’×™××” ×‘×©××™×¨×ª ××ª×›×•× ×™×:', error);
                console.error('×¤×¨×˜×™ ×”×©×’×™××”:', error.message, error.stack);
                throw new Error('×œ× ×”×¦×œ×—× ×• ×œ×©××•×¨ ××ª ×”××ª×›×•× ×™×: ' + error.message);
            }
        }

        // ×™×¦×™×¨×ª ID ×™×™×—×•×“×™
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // × ×™×”×•×œ ××¡×›×™× ×•××¢×‘×¨ ××”×™×¨ ×‘×™×Ÿ ×©×œ×‘×™×
        let currentRecipe = null;
        let currentScreen = 'main';

        // ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª ××¡×›×™×
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
                screen.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('active');
                currentScreen = screenId;
            }
        }

        // ×˜×¢×™× ×ª ××ª×›×•× ×™× ×•×”×¦×’×ª×
        async function loadAndDisplayRecipes() {
            const recipesList = document.getElementById('recipes-list');
            recipesList.innerHTML = '<div class="loading">×˜×•×¢×Ÿ ××ª×›×•× ×™×...</div>';
            
            const recipes = await loadRecipes();
            
            if (recipes.length === 0) {
                recipesList.innerHTML = '<div class="loading">××™×Ÿ ××ª×›×•× ×™×. ×œ×—×¥ ×¢×œ "×”×•×¡×£ ××ª×›×•×Ÿ" ×œ×”×ª×—×™×œ</div>';
                return;
            }
            
            recipesList.innerHTML = recipes.map(recipe => 
                `<div class="recipe-card" data-recipe-id="${recipe.id}">${recipe.name}</div>`
            ).join('');
            
            // ×”×•×¡×¤×ª ×××–×™× ×™×
            document.querySelectorAll('.recipe-card').forEach(card => {
                card.addEventListener('click', () => {
                    const recipeId = card.dataset.recipeId;
                    const recipe = recipes.find(r => r.id === recipeId);
                    if (recipe) {
                        currentRecipe = recipe;
                        showActionSelection(recipe);
                    }
                });
            });
        }

        // ×”×¦×’×ª ××¡×š ×‘×—×™×¨×ª ×¤×¢×•×œ×”
        function showActionSelection(recipe) {
            document.getElementById('selected-recipe-name').textContent = recipe.name;
            showScreen('action-selection-screen');
        }

        // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
        document.addEventListener('DOMContentLoaded', async () => {
            await loadAndDisplayRecipes();
            setupEventListeners();
        });

        // ×”×’×“×¨×ª ×××–×™× ×™×
        function setupEventListeners() {
            // ×›×¤×ª×•×¨×™ ××¡×š ×¨××©×™
            document.getElementById('add-recipe-btn')?.addEventListener('click', () => {
                showScreen('admin-screen');
                document.getElementById('admin-title').textContent = '×”×•×¡×£ ××ª×›×•×Ÿ ×—×“×©';
                document.getElementById('cancel-edit-btn').classList.add('hidden');
                document.getElementById('add-recipe-form').reset();
            });
            
            document.getElementById('edit-recipes-btn')?.addEventListener('click', () => {
                showScreen('edit-list-screen');
                loadEditList();
            });
            
            document.getElementById('refresh-btn')?.addEventListener('click', async () => {
                await loadAndDisplayRecipes();
            });
            
            // ×›×¤×ª×•×¨×™ ×—×–×¨×”
            document.getElementById('back-to-main')?.addEventListener('click', () => {
                showScreen('main-screen');
                currentRecipe = null;
            });
            
            document.getElementById('back-from-admin')?.addEventListener('click', () => {
                showScreen('main-screen');
            });
            
            document.getElementById('back-from-edit-list')?.addEventListener('click', () => {
                showScreen('main-screen');
            });
            
            // ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×•×ª
            document.getElementById('kit-action-btn')?.addEventListener('click', () => {
                if (currentRecipe) showKitScreen(currentRecipe);
            });
            
            document.getElementById('division-action-btn')?.addEventListener('click', () => {
                if (currentRecipe) showDivisionScreen(currentRecipe);
            });
            
            document.getElementById('oven-action-btn')?.addEventListener('click', () => {
                if (currentRecipe) showOvenScreen(currentRecipe);
            });
            
            // ×›×¤×ª×•×¨×™ ×—×–×¨×” ××©×œ×‘×™×
            document.getElementById('back-from-kit')?.addEventListener('click', () => {
                if (currentRecipe) showActionSelection(currentRecipe);
            });
            
            document.getElementById('back-from-division')?.addEventListener('click', () => {
                if (currentRecipe) showActionSelection(currentRecipe);
            });
            
            document.getElementById('back-from-oven')?.addEventListener('click', () => {
                if (currentRecipe) showActionSelection(currentRecipe);
            });
            
            // ×‘×—×™×¨×ª ×¡×•×’ ×ª×‘× ×™×ª - ×—×œ×•×§×”
            document.getElementById('gastronorm-btn')?.addEventListener('click', () => {
                if (currentRecipe) {
                    updateContainerButtons('gastronorm');
                    displayDivisionContent(currentRecipe, 'gastronorm');
                }
            });
            
            document.getElementById('sift-btn')?.addEventListener('click', () => {
                if (currentRecipe) {
                    updateContainerButtons('sift');
                    displayDivisionContent(currentRecipe, 'sift');
                }
            });
            
            // ×‘×—×™×¨×ª ×¡×•×’ ×ª×‘× ×™×ª - ×ª× ×•×¨
            document.getElementById('oven-gastronorm-btn')?.addEventListener('click', () => {
                if (currentRecipe) {
                    updateOvenContainerButtons('gastronorm');
                    displayOvenContent(currentRecipe, 'gastronorm');
                }
            });
            
            document.getElementById('oven-sift-btn')?.addEventListener('click', () => {
                if (currentRecipe) {
                    updateOvenContainerButtons('sift');
                    displayOvenContent(currentRecipe, 'sift');
                }
            });
            
            // ×˜×•×¤×¡ ×”×•×¡×¤×ª ××ª×›×•×Ÿ
            const form = document.getElementById('add-recipe-form');
            if (form) {
                console.log('âœ… ×˜×•×¤×¡ × ××¦× ×•××—×•×‘×¨');
                form.addEventListener('submit', handleFormSubmit);
            } else {
                console.error('âŒ ×˜×•×¤×¡ ×œ× × ××¦×!');
            }
            
            // ×›×¤×ª×•×¨ ×‘×™×˜×•×œ ×¢×¨×™×›×”
            document.getElementById('cancel-edit-btn')?.addEventListener('click', () => {
                showScreen('main-screen');
                currentRecipe = null;
                form.reset();
                document.getElementById('cancel-edit-btn').classList.add('hidden');
                document.getElementById('admin-title').textContent = '×”×•×¡×£ ××ª×›×•×Ÿ ×—×“×©';
            });
            
            // ×”×•×¡×¤×ª ×¨×›×™×‘ ×§×™×˜
            document.getElementById('add-kit-ingredient')?.addEventListener('click', addKitIngredientRow);
            
            // ××—×™×§×ª ×¨×›×™×‘
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-ingredient')) {
                    e.target.parentElement.remove();
                }
            });
        }

        // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×ª×‘× ×™×ª
        function updateContainerButtons(selectedType) {
            document.querySelectorAll('.container-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${selectedType}"]`)?.classList.add('active');
        }

        function updateOvenContainerButtons(selectedType) {
            document.querySelectorAll('#oven-screen .container-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`#oven-screen [data-type="${selectedType}"]`)?.classList.add('active');
        }

        // ×”×¦×’×ª ××¡×š ×§×™×˜×™×
        function showKitScreen(recipe) {
            document.getElementById('kit-recipe-name').textContent = recipe.name;
            showScreen('kit-screen');
            displayKitContent(recipe);
        }

        // ×”×¦×’×ª ×ª×•×›×Ÿ ×§×™×˜
        function displayKitContent(recipe) {
            const baseBatch = recipe.baseBatchKg || 10;
            document.getElementById('base-batch-info').textContent = `×›××•×ª ×‘×¡×™×¡: ${baseBatch} ×§"×’`;
            
            // ×”×•×¡×¤×ª ×××–×™× ×™× ×œ×›×¤×ª×•×¨×™ ×›××•×ª
            document.querySelectorAll('.quantity-btn').forEach(btn => {
                btn.onclick = () => {
                    const quantity = parseInt(btn.dataset.quantity);
                    const multiplier = quantity / baseBatch;
                    document.getElementById('multiplier-info').textContent = `××›×¤×™×œ: x${multiplier.toFixed(1)}`;
                    document.getElementById('selected-quantity-badge').textContent = `${quantity} ×§"×’`;
                    document.getElementById('selected-quantity-badge').style.display = 'inline-block';
                    
                    // ×”×¦×’×ª ×¨×›×™×‘×™× ×¢× ×—×™×©×•×‘
                    const ingredientsList = document.getElementById('kit-ingredients');
                    ingredientsList.innerHTML = recipe.kitIngredients.map(ing => {
                        const calculatedAmount = (ing.amount * multiplier).toFixed(2);
                        return `
                            <div class="ingredient-item">
                                <span class="ingredient-name">${ing.name}</span>
                                <span class="ingredient-amount">${calculatedAmount} ${ing.unit}</span>
                            </div>
                        `;
                    }).join('');
                };
            });
        }

        // ×”×¦×’×ª ××¡×š ×—×œ×•×§×”
        function showDivisionScreen(recipe) {
            document.getElementById('division-recipe-name').textContent = recipe.name;
            showScreen('division-screen');
            updateContainerButtons('gastronorm');
            displayDivisionContent(recipe, 'gastronorm');
        }

        // ×”×¦×’×ª ×ª×•×›×Ÿ ×—×œ×•×§×”
        function displayDivisionContent(recipe, type) {
            const content = document.getElementById('division-content');
            const data = type === 'gastronorm' ? recipe.gastronorm : recipe.sift;
            
            if (!data) {
                content.innerHTML = '<div class="loading">××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×</div>';
                return;
            }
            
            content.innerHTML = `
                <div class="division-info">
                    <div class="info-item">
                        <span class="info-label">×›××•×ª ×—×•×’:</span>
                        <span class="info-value">${data.doughAmount || 0} ×§"×’</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">×›××•×ª ××™×:</span>
                        <span class="info-value">${data.waterAmount || 0} ×œ×™×˜×¨</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">×¡×•×’ ××™×:</span>
                        <span class="info-value">${data.waterType || '×œ× ××•×’×“×¨'}</span>
                    </div>
                </div>
            `;
        }

        // ×”×¦×’×ª ××¡×š ×ª× ×•×¨
        function showOvenScreen(recipe) {
            document.getElementById('oven-recipe-name').textContent = recipe.name;
            showScreen('oven-screen');
            updateOvenContainerButtons('gastronorm');
            displayOvenContent(recipe, 'gastronorm');
        }

        // ×”×¦×’×ª ×ª×•×›×Ÿ ×ª× ×•×¨
        function displayOvenContent(recipe, type) {
            const content = document.getElementById('oven-content');
            const data = type === 'gastronorm' ? recipe.gastronormOven : recipe.siftOven;
            
            if (!data) {
                content.innerHTML = '<div class="loading">××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×</div>';
                return;
            }
            
            content.innerHTML = `
                <div class="oven-info">
                    <div class="setting-item">
                        <div class="setting-label">×¡×•×’ ×ª×•×›× ×™×ª</div>
                        <div class="setting-value">${data.program || '×œ× ××•×’×“×¨'}</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">×˜××¤×¨×˜×•×¨×”</div>
                        <div class="setting-value">${data.temp || 0}Â°C</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">×–××Ÿ</div>
                        <div class="setting-value">${data.time || 0} ×“×§×•×ª</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">×œ×—×•×ª</div>
                        <div class="setting-value">${data.humidity || 0}%</div>
                    </div>
                    ${data.notes ? `
                    <div class="setting-item">
                        <div class="setting-label">×”×¢×¨×•×ª</div>
                        <div class="setting-value">${data.notes}</div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // ×˜×™×¤×•×œ ×‘×©×œ×™×—×ª ×˜×•×¤×¡
        async function handleFormSubmit(e) {
            console.log('=== handleFormSubmit × ×§×¨× ===');
            e.preventDefault();
            
            // ×§×¨×™××ª ×›×œ ×”×¢×¨×›×™× ××”×˜×•×¤×¡
            const getValue = (id) => {
                const el = document.getElementById(id);
                if (!el) {
                    console.warn('âš ï¸ ××œ×× ×˜ ×œ× × ××¦×:', id);
                    return '';
                }
                return el.value || '';
            };
            
            const getNumber = (id, defaultValue = 0) => {
                const el = document.getElementById(id);
                if (!el || !el.value) return defaultValue;
                const val = parseFloat(el.value);
                return isNaN(val) ? defaultValue : val;
            };
            
            const getInt = (id, defaultValue = 0) => {
                const el = document.getElementById(id);
                if (!el || !el.value) return defaultValue;
                const val = parseInt(el.value);
                return isNaN(val) ? defaultValue : val;
            };
            
            console.log('×§×•×¨× × ×ª×•× ×™× ××”×˜×•×¤×¡...');
            const name = getValue('recipe-name-input');
            const baseBatchKg = getNumber('base-batch-input', 10);
            const preparationInstructions = getValue('preparation-instructions');
            
            console.log('×©×:', name);
            console.log('×›××•×ª ×‘×¡×™×¡:', baseBatchKg);
            console.log('×”×•×¨××•×ª ×”×›× ×”:', preparationInstructions);
            
            const recipe = {
                id: document.getElementById('cancel-edit-btn').classList.contains('hidden') 
                    ? generateId() 
                    : currentRecipe?.id || generateId(),
                name: name,
                baseBatchKg: baseBatchKg,
                kitIngredients: getKitIngredients(),
                preparationInstructions: preparationInstructions,
                gastronorm: {
                    doughAmount: getNumber('gastronorm-dough-amount', 0),
                    waterAmount: getNumber('gastronorm-water-amount', 0),
                    waterType: getValue('gastronorm-water-type') || '×—×'
                },
                sift: {
                    doughAmount: getNumber('sift-dough-amount', 0),
                    waterAmount: getNumber('sift-water-amount', 0),
                    waterType: getValue('sift-water-type') || '×—×'
                },
                gastronormOven: {
                    program: getValue('gastronorm-oven-program'),
                    temp: getInt('gastronorm-oven-temp', 0),
                    time: getInt('gastronorm-oven-time', 0),
                    humidity: getInt('gastronorm-oven-humidity', 0),
                    notes: getValue('gastronorm-oven-notes')
                },
                siftOven: {
                    program: getValue('sift-oven-program'),
                    temp: getInt('sift-oven-temp', 0),
                    time: getInt('sift-oven-time', 0),
                    humidity: getInt('sift-oven-humidity', 0),
                    notes: getValue('sift-oven-notes')
                }
            };
            
            // ×‘×“×™×§×” - ×”×“×¤×¡×” ×œ×§×•× ×¡×•×œ
            console.log('=== ××ª×›×•×Ÿ ×œ×¤× ×™ ×©××™×¨×” ===');
            console.log('×©×•××¨ ××ª×›×•×Ÿ:', recipe);
            console.log('×’×¡×˜×¨×•× ×•×:', recipe.gastronorm);
            console.log('×¡×™×¤×˜:', recipe.sift);
            console.log('×ª× ×•×¨ ×’×¡×˜×¨×•× ×•×:', recipe.gastronormOven);
            console.log('×ª× ×•×¨ ×¡×™×¤×˜:', recipe.siftOven);
            console.log('========================');
            
            try {
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = '×©×•××¨...';
                submitBtn.disabled = true;
                
                const recipes = await loadRecipes();
                const existingIndex = recipes.findIndex(r => r.id === recipe.id);
                
                if (existingIndex >= 0) {
                    recipes[existingIndex] = recipe;
                } else {
                    recipes.push(recipe);
                }
                
                console.log('×©×•×œ×— ×œ-Apps Script:', recipes);
                await saveRecipes(recipes);
                alert('××ª×›×•×Ÿ × ×©××¨ ×‘×”×¦×œ×—×”!');
                e.target.reset();
                showScreen('main-screen');
                await loadAndDisplayRecipes();
                
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            } catch (error) {
                console.error('×©×’×™××”:', error);
                alert('×©×’×™××” ×‘×©××™×¨×ª ×”××ª×›×•×Ÿ. × ×¡×” ×©×•×‘.\n\n×¤×ª×— ××ª ×”×§×•× ×¡×•×œ (F12) ×œ×¤×¨×˜×™× × ×•×¡×¤×™×.');
                e.target.querySelector('button[type="submit"]').disabled = false;
            }
        }

        // ×§×‘×œ×ª ×¨×›×™×‘×™ ×§×™×˜ ××”×˜×•×¤×¡
        function getKitIngredients() {
            const rows = document.querySelectorAll('.ingredient-row');
            return Array.from(rows).map(row => {
                const name = row.querySelector('.ingredient-name').value;
                const amount = parseFloat(row.querySelector('.ingredient-amount').value);
                const unit = row.querySelector('.ingredient-unit').value;
                
                if (!name || !amount) return null;
                
                return { name, amount, unit };
            }).filter(ing => ing !== null);
        }

        // ×”×•×¡×¤×ª ×©×•×¨×ª ×¨×›×™×‘ ×§×™×˜
        function addKitIngredientRow() {
            const container = document.getElementById('kit-ingredients-inputs');
            const newRow = document.createElement('div');
            newRow.className = 'ingredient-row';
            newRow.innerHTML = `
                <input type="text" placeholder="×©× ×¨×›×™×‘" class="ingredient-name">
                <input type="number" placeholder="×›××•×ª" class="ingredient-amount" step="0.01" min="0">
                <select class="ingredient-unit">
                    <option value="×’×¨×">×’×¨×</option>
                    <option value="×§"×’">×§"×’</option>
                    <option value="×"×œ">×"×œ</option>
                    <option value="×œ×™×˜×¨">×œ×™×˜×¨</option>
                    <option value="×›×¤×™×•×ª">×›×¤×™×•×ª</option>
                    <option value="×›×¤×•×ª">×›×¤×•×ª</option>
                    <option value="×›×•×¡×•×ª">×›×•×¡×•×ª</option>
                    <option value="×™×—×™×“×•×ª">×™×—×™×“×•×ª</option>
                    <option value="×—×‘×™×œ×•×ª">×—×‘×™×œ×•×ª</option>
                </select>
                <button type="button" class="remove-ingredient">Ã—</button>
            `;
            container.appendChild(newRow);
        }

        // ×˜×¢×™× ×ª ×¨×©×™××ª ×¢×¨×™×›×”
        async function loadEditList() {
            const list = document.getElementById('admin-recipes-list');
            list.innerHTML = '<div class="loading">×˜×•×¢×Ÿ ××ª×›×•× ×™×...</div>';
            
            const recipes = await loadRecipes();
            
            if (recipes.length === 0) {
                list.innerHTML = '<div class="loading">××™×Ÿ ××ª×›×•× ×™×</div>';
                return;
            }
            
            list.innerHTML = recipes.map(recipe => `
                <div class="admin-recipe-item">
                    <h3>${recipe.name}</h3>
                    <p>×›××•×ª ×‘×¡×™×¡: ${recipe.baseBatchKg || 10} ×§"×’</p>
                    <p>×¨×›×™×‘×™ ×§×™×˜: ${recipe.kitIngredients?.length || 0}</p>
                    <div class="admin-recipe-actions">
                        <button class="btn-edit" onclick="editRecipe('${recipe.id}')">×¢×¨×•×š</button>
                        <button class="btn-delete" onclick="deleteRecipe('${recipe.id}')">××—×§</button>
                    </div>
                </div>
            `).join('');
        }

        // ×¢×¨×™×›×ª ××ª×›×•×Ÿ
        window.editRecipe = async function(recipeId) {
            const recipes = await loadRecipes();
            const recipe = recipes.find(r => r.id === recipeId);
            
            if (!recipe) return;
            
            currentRecipe = recipe;
            
            // ×˜×¢×™× ×ª × ×ª×•× ×™× ×œ×˜×•×¤×¡
            document.getElementById('recipe-name-input').value = recipe.name;
            document.getElementById('base-batch-input').value = recipe.baseBatchKg || 10;
            document.getElementById('preparation-instructions').value = recipe.preparationInstructions || '';
            
            // ×¨×›×™×‘×™ ×§×™×˜
            const container = document.getElementById('kit-ingredients-inputs');
            container.innerHTML = '';
            if (recipe.kitIngredients && recipe.kitIngredients.length > 0) {
                recipe.kitIngredients.forEach(ing => {
                    const row = document.createElement('div');
                    row.className = 'ingredient-row';
                    row.innerHTML = `
                        <input type="text" placeholder="×©× ×¨×›×™×‘" class="ingredient-name" value="${ing.name}">
                        <input type="number" placeholder="×›××•×ª" class="ingredient-amount" step="0.01" min="0" value="${ing.amount}">
                        <select class="ingredient-unit">
                            <option value="×’×¨×" ${ing.unit === '×’×¨×' ? 'selected' : ''}>×’×¨×</option>
                            <option value="×§"×’" ${ing.unit === '×§"×’' ? 'selected' : ''}>×§"×’</option>
                            <option value="×"×œ" ${ing.unit === '×"×œ' ? 'selected' : ''}>×"×œ</option>
                            <option value="×œ×™×˜×¨" ${ing.unit === '×œ×™×˜×¨' ? 'selected' : ''}>×œ×™×˜×¨</option>
                            <option value="×›×¤×™×•×ª" ${ing.unit === '×›×¤×™×•×ª' ? 'selected' : ''}>×›×¤×™×•×ª</option>
                            <option value="×›×¤×•×ª" ${ing.unit === '×›×¤×•×ª' ? 'selected' : ''}>×›×¤×•×ª</option>
                            <option value="×›×•×¡×•×ª" ${ing.unit === '×›×•×¡×•×ª' ? 'selected' : ''}>×›×•×¡×•×ª</option>
                            <option value="×™×—×™×“×•×ª" ${ing.unit === '×™×—×™×“×•×ª' ? 'selected' : ''}>×™×—×™×“×•×ª</option>
                            <option value="×—×‘×™×œ×•×ª" ${ing.unit === '×—×‘×™×œ×•×ª' ? 'selected' : ''}>×—×‘×™×œ×•×ª</option>
                        </select>
                        <button type="button" class="remove-ingredient">Ã—</button>
                    `;
                    container.appendChild(row);
                });
            } else {
                addKitIngredientRow();
            }
            
            // ×’×¡×˜×¨×•× ×•×
            if (recipe.gastronorm) {
                document.getElementById('gastronorm-dough-amount').value = recipe.gastronorm.doughAmount || '';
                document.getElementById('gastronorm-water-amount').value = recipe.gastronorm.waterAmount || '';
                document.getElementById('gastronorm-water-type').value = recipe.gastronorm.waterType || '×—×';
            }
            
            // ×¡×™×¤×˜
            if (recipe.sift) {
                document.getElementById('sift-dough-amount').value = recipe.sift.doughAmount || '';
                document.getElementById('sift-water-amount').value = recipe.sift.waterAmount || '';
                document.getElementById('sift-water-type').value = recipe.sift.waterType || '×—×';
            }
            
            // ×ª× ×•×¨ ×’×¡×˜×¨×•× ×•×
            if (recipe.gastronormOven) {
                document.getElementById('gastronorm-oven-program').value = recipe.gastronormOven.program || '';
                document.getElementById('gastronorm-oven-temp').value = recipe.gastronormOven.temp || '';
                document.getElementById('gastronorm-oven-time').value = recipe.gastronormOven.time || '';
                document.getElementById('gastronorm-oven-humidity').value = recipe.gastronormOven.humidity || '';
                document.getElementById('gastronorm-oven-notes').value = recipe.gastronormOven.notes || '';
            }
            
            // ×ª× ×•×¨ ×¡×™×¤×˜
            if (recipe.siftOven) {
                document.getElementById('sift-oven-program').value = recipe.siftOven.program || '';
                document.getElementById('sift-oven-temp').value = recipe.siftOven.temp || '';
                document.getElementById('sift-oven-time').value = recipe.siftOven.time || '';
                document.getElementById('sift-oven-humidity').value = recipe.siftOven.humidity || '';
                document.getElementById('sift-oven-notes').value = recipe.siftOven.notes || '';
            }
            
            document.getElementById('admin-title').textContent = '×¢×¨×•×š ××ª×›×•×Ÿ';
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            showScreen('admin-screen');
        };

        // ××—×™×§×ª ××ª×›×•×Ÿ
        window.deleteRecipe = async function(recipeId) {
            if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª×›×•×Ÿ ×–×”?')) {
                return;
            }
            
            try {
                const recipes = await loadRecipes();
                const filtered = recipes.filter(r => r.id !== recipeId);
                await saveRecipes(filtered);
                await loadEditList();
            } catch (error) {
                console.error('×©×’×™××”:', error);
                alert('×©×’×™××” ×‘××—×™×§×ª ×”××ª×›×•×Ÿ. × ×¡×” ×©×•×‘.');
            }
        };
    </script>
</body>
</html>
